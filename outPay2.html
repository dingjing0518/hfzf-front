<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <script src="libs/jquery.min.js"></script>
</head>
<style>
    .box {
        width: 100%;
        height: 45px;
        display: flex;
    }

    .box p {
        height: 30px;
        line-height: 30px;
    }

    .box p:first-child {
        flex: 1;
        text-align: center;
        border: 1px rgb(22, 21, 21) solid;
    }

    .box p:last-child {
        flex: 3;
        border: 1px rgb(102, 172, 139) solid;
        padding-left: 10px;
    }
    .goPay {
        width: 100%;
        height: 40px;
        text-align: center;
        line-height: 40px;
        margin-top: 60px;
    }
    .goPay button {
        width: 100px;
        height: 38px;
        color: rgb(32, 158, 53);
        font-size: 20px;
    }
</style>

<body>
    <!-- <p class="icon-er"></p> -->
    <!-- <div class="divv">
        <img src="http://www.visionunion.com/admin/data/file/img/20191126/20191126000605.gif" alt=""> 
    </div>  -->
    <div id='getCar'>
        <div class="box">
            <p>车牌号:</p>
            <p id='plateNumber'></p>
        </div>
        <div class="box">
            <p>入场时间:</p>
            <p id='intoTime'></p>
        </div>
        <div class="box">
            <p>出场时间:</p>
            <p id='goOutTime'></p>
        </div>
        <div class="box">
            <p>停车时长:</p>
            <p id='stopTime'></p>
        </div>
        <div class="box">
            <p>支付金额:</p>
            <p id='payNum'></p>
        </div>
        <div class="goPay">
            <button id="pay">支&nbsp&nbsp&nbsp付</button>
        </div>
    </div>
    <div style="text-align: center;" id='noCar'>
        <h2>未查到此车辆</h2>
    </div>
    <div style="display: none;">
        <p id="aaa"></p>
    </div>
</body>
<script>
    //去支付
    var pay = document.getElementById('pay')
    pay.onclick = function(){
        var params = {
         amount : document.getElementById('payNum').innerHTML,
         lpInboundTime : document.getElementById('intoTime').innerHTML,
         lpLincensePlateIdCar: document.getElementById('plateNumber').innerHTML,
         lpParkingName : document.getElementById('aaa').innerHTML
        }
        $.ajax({
            url: "http://101.132.105.124:8080/carmanager-TEST/payTest/paypark",
            contentType: "application/json",
            dataType: "json",
            type: "POST",
            data: JSON.stringify(params),
            success:function(res){
                console.log(res)
                window.location.href=res.payurl
            },
            err:function(res){
                console.log(res)
            }
        })
    }
    function add() {
        var search = window.location.search;
        var ccbParkId = getSearchString('ccbParkId', search); //结果：18
        console.log(ccbParkId)
        var jcName = getSearchString('jcName', search); //结果：2
        // 添加A标签

        function getSearchString(key, Url) {
            var str = Url;
            str = str.substring(1, str.length); // 获取URL中?之后的字符（去掉第一位的问号）
            // 以&分隔字符串，获得类似name=xiaoli这样的元素数组
            var arr = str.split("&");
            var obj = new Object();
            // 将每一个数组元素以=分隔并赋给obj对象
            for (var i = 0; i < arr.length; i++) {
                var tmp_arr = arr[i].split("=");
                obj[decodeURIComponent(tmp_arr[0])] = decodeURIComponent(tmp_arr[1]);
            }
            return obj[key];
        }

        var param = {
             "ccbParkId": Number(ccbParkId),
             "jcName": String(jcName) 
            // "ccbParkId": 27,
            //"ccbParkId": 1,
            //"jcName": "南出口1"
            // "jcName": "P6体育馆南辅助出口"
        }

        $.ajax({
            // url: "http://123.207.168.102:8089/carmanage_war/payTest/checkRent",
            // url: "http://192.168.0.44:8080/carmanager_war/payTest/checkRent",
            url: "http://101.132.105.124:8080/carmanager-TEST/payTest/checkRent",
            contentType: "application/json",
            dataType: "json",
            type: "POST",
            data: JSON.stringify(param),
            success: function (data) {
                if(data.msg){
                    document.getElementById('getCar').style.display = 'none'
                    var noDiv = document.getElementById('noCar')
                }else {
                    var Car = document.getElementById('noCar')
                    Car.style.display='none'
                    document.getElementById('plateNumber').innerHTML = data.lpLincensePlateIdCar
                    document.getElementById('intoTime').innerHTML = data.lpInboundTime
                    document.getElementById('goOutTime').innerHTML =getdate()
                    var abc = getdate()
                    document.getElementById('stopTime').innerHTML = DateMinus(data.lpInboundTime,abc)
                    document.getElementById('payNum').innerHTML = data.amount
                    document.getElementById('aaa').innerText = data.lpParkingName
                }
                // if (data.msg) {
                //     // var aa=document.getElementsByClassName("icon-er")[0]
                //     // aa.innerHTML=data.msg
                //     $(".icon-er").text(data.msg)
                // } else {
                //     console.log(data.payurl)
                //     var a = document.createElement('a');
                //     a.setAttribute('href', data.payurl);
                //     a.setAttribute('id', 'startTelMedicine');
                //     // 防止反复添加
                //     if (document.getElementById('startTelMedicine')) {
                //         document.body.removeChild(document.getElementById('startTelMedicine'));
                //     }
                //     document.body.appendChild(a);
                //     a.click();
                // }

            },
            error: function (err) {
                console.log(err)

            },
        });
     
    };
    //获取当前 时间
    function getdate(){
	    const dt = new Date();
    	const y = dt.getFullYear();
    	const m = dt.getMonth() + 1;
    	const d = dt.getDate();
    	const hh = dt.getHours().toString().padStart(2, 0);
    	const mm = dt.getMinutes().toString().padStart(2, 0);
    	const ss = dt.getSeconds().toString().padStart(2, 0);
    	const time = y + '-' + m + '-' + d + ' ' + hh + ':' + mm + ':' + ss;
		return time;
    }
    //两个时间相减
    function DateMinus(date1,date2){//date1:小日期   date2:大日期
        console.log(date1,date2)
  　　var sdate = new Date(date2.replace(/-/g, '/')).getTime(); 
  　　var now = new Date(date1.replace(/-/g, '/')).getTime(); 
  　　var days = (sdate -now )/1000; 
      var  timestamp_day = Math.floor(days/86400) 
      var  timestamp_hour = Math.floor(days%86400/3600) 
      var  timestamp_minutes = Math.floor(days%86400%3600/60) 
  　　return timestamp_day+'天'+timestamp_hour+'时'+timestamp_minutes+'分'; 
     }
     //去支付

    add()
    //提交按钮点击事件
</script>
<style>
    /* .divv{
           width: 100%;
           height:100%;
           overflow: hidden;
           text-align: center;
           border:1px red solid
       }
       .divv>img{
           width: 100%;
           margin-top: 200px;
       } */
</style>

</html>